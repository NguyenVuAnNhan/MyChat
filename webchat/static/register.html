<!DOCTYPE html>
<html>
<head>
  <link rel="icon" type="image/png" href="/static/image/favicon.ico">
  <title>Register</title>
</head>
<body>
  <h2>Register</h2>
  <form id="registerForm" method="POST" action="/auth/register">
    <label>Username:</label>
    <input type="text" name="username" required /><br>

    <label>Password:</label>
    <input type="password" name="password" required /><br>

    <button type="submit">Register</button>
  </form>

  <p>Already have an account? <a href="/login">Login here</a></p>
</body>
<script>
  document.getElementById("registerForm").addEventListener("submit", async (e) => {
    e.preventDefault();
  
    const formData = new FormData(e.target);
    const payload = new URLSearchParams();
    formData.forEach((value, key) => {
      payload.append(key, value);
    });
  
    try {
      // 1. Register
      let res = await fetch("/auth/register", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: payload
      });
  
      if (!res.ok) throw new Error("Register failed");
  
      // 2. Login right after registration
      res = await fetch("/auth/login", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: payload
      });
  
      if (!res.ok) throw new Error("Login failed");
  
      const data = await res.json();
      console.log("Logged in:", data);
  
      // 3. Redirect or update UI
      window.location.href = "/";
    } catch (err) {
      alert(err.message);
    }
  });
  </script>   
</html>
