<!DOCTYPE html>
<html>
<head>
  <title>Login</title>
</head>
<body>
  <h2>Login</h2>
  <form id="loginForm" method="POST" action="/auth/login">
    <label>Username:</label>
    <input type="text" name="username" required /><br>

    <label>Password:</label>
    <input type="password" name="password" required /><br>

    <button type="submit">Login</button>
  </form>

  <p>Don't have an account? <a href="/register">Register here</a></p>
</body>
<script>
  document.getElementById("loginForm").addEventListener("submit", async (e) => {
    e.preventDefault();
  
    const formData = new FormData(e.target);
    const payload = new URLSearchParams();
    formData.forEach((value, key) => {
      payload.append(key, value);
    });
  
    try {
      // 1. Login
      let res = await fetch("/auth/login", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: payload
      });
  
      if (!res.ok) throw new Error("Login failed");
  
      const data = await res.json();
      console.log("Logged in:", data);
  
      // 2. Redirect or update UI
      window.location.href = "/";
    } catch (err) {
      alert(err.message);
    }
  });
  </script>
  
</html>
